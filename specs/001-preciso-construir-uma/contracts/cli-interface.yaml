# CLI Interface Contract: NPM Package Malware Analysis System
# Version: 1.0.0
# Description: Command-line interface specification for the malware analysis tool

commands:
  analyze:
    description: "Analyze one or more NPM packages for security vulnerabilities"
    usage: "npm-sec-analyzer analyze [options] <package-names...>"
    options:
      - name: "--version"
        alias: "-v" 
        type: "string"
        description: "Specific package version to analyze (default: latest)"
        example: "--version 1.2.3"
      - name: "--format"
        alias: "-f"
        type: "string"
        choices: ["json", "text", "html"]
        default: "text"
        description: "Output format for analysis results"
        example: "--format json"
      - name: "--output"
        alias: "-o"
        type: "string"
        description: "Output file path (default: stdout)"
        example: "--output report.json"
      - name: "--depth"
        alias: "-d"
        type: "number"
        default: 5
        min: 1
        max: 15
        description: "Maximum dependency tree depth to analyze"
        example: "--depth 10"
      - name: "--cache"
        type: "boolean"
        default: true
        description: "Use cached results when available"
        example: "--no-cache"
      - name: "--severity"
        alias: "-s"
        type: "string"
        choices: ["low", "medium", "high", "critical"]
        default: "medium"
        description: "Minimum severity level to report"
        example: "--severity high"
      - name: "--timeout"
        alias: "-t"
        type: "number"
        default: 30
        min: 5
        max: 300
        description: "Analysis timeout in seconds per package"
        example: "--timeout 60"
    arguments:
      - name: "package-names"
        type: "string[]"
        required: true
        description: "One or more NPM package names to analyze"
        example: "express lodash"
    examples:
      - command: "npm-sec-analyzer analyze express"
        description: "Analyze latest version of express package"
      - command: "npm-sec-analyzer analyze express@4.18.0 --format json"
        description: "Analyze specific version with JSON output"
      - command: "npm-sec-analyzer analyze express lodash --depth 10 --severity high"
        description: "Analyze multiple packages with custom depth and severity filter"

  scan:
    description: "Scan package.json file for all dependencies"
    usage: "npm-sec-analyzer scan [options] [package-json-path]"
    options:
      - name: "--file"
        alias: "-f"
        type: "string"
        default: "./package.json"
        description: "Path to package.json file to scan"
        example: "--file ./backend/package.json"
      - name: "--include-dev"
        type: "boolean"
        default: false
        description: "Include devDependencies in analysis"
        example: "--include-dev"
      - name: "--exclude"
        alias: "-e"
        type: "string[]"
        description: "Package names to exclude from analysis"
        example: "--exclude @types/* eslint*"
      - name: "--format"
        alias: "-o"
        type: "string"
        choices: ["json", "text", "html"]
        default: "text"
        description: "Output format for scan results"
      - name: "--output"
        type: "string"
        description: "Output file path (default: stdout)"
    arguments:
      - name: "package-json-path"
        type: "string"
        required: false
        default: "./package.json"
        description: "Path to package.json file (optional)"
    examples:
      - command: "npm-sec-analyzer scan"
        description: "Scan current directory's package.json"
      - command: "npm-sec-analyzer scan --include-dev --format json"
        description: "Scan including dev dependencies with JSON output"
      - command: "npm-sec-analyzer scan ./backend/package.json --exclude @types/*"
        description: "Scan specific package.json excluding type definitions"

  cache:
    description: "Manage analysis result cache"
    usage: "npm-sec-analyzer cache <subcommand> [options]"
    subcommands:
      clear:
        description: "Clear all cached analysis results"
        usage: "npm-sec-analyzer cache clear [options]"
        options:
          - name: "--force"
            alias: "-f"
            type: "boolean"
            description: "Force clear without confirmation prompt"
      info:
        description: "Show cache statistics and information"
        usage: "npm-sec-analyzer cache info"
        output:
          - "Total cached analyses: N"
          - "Cache size: X MB"
          - "Oldest entry: YYYY-MM-DD"
          - "Cache hit rate: X%"
      clean:
        description: "Remove expired cache entries"
        usage: "npm-sec-analyzer cache clean"

  config:
    description: "Manage tool configuration"
    usage: "npm-sec-analyzer config <subcommand> [options]"
    subcommands:
      set:
        description: "Set configuration value"
        usage: "npm-sec-analyzer config set <key> <value>"
        examples:
          - command: "npm-sec-analyzer config set api-key YOUR_OPENROUTER_KEY"
            description: "Set OpenRouter API key"
          - command: "npm-sec-analyzer config set cache-ttl 168"
            description: "Set cache TTL to 168 hours (7 days)"
      get:
        description: "Get configuration value"
        usage: "npm-sec-analyzer config get <key>"
        examples:
          - command: "npm-sec-analyzer config get cache-ttl"
            description: "Show current cache TTL setting"
      list:
        description: "List all configuration settings"
        usage: "npm-sec-analyzer config list"

global_options:
  - name: "--help"
    alias: "-h"
    description: "Show help information"
  - name: "--version"
    alias: "-V"
    description: "Show version number"
  - name: "--verbose"
    type: "boolean"
    description: "Enable verbose logging"
  - name: "--quiet"
    alias: "-q"
    type: "boolean"
    description: "Suppress non-error output"
  - name: "--config"
    type: "string"
    description: "Path to custom configuration file"
    example: "--config ./custom-config.json"

exit_codes:
  0: "Success - no security issues found above threshold"
  1: "Security issues found above severity threshold"  
  2: "Command-line argument error"
  3: "Configuration error"
  4: "Network/API error"
  5: "File system error"
  6: "Analysis timeout"
  7: "Internal error"

output_formats:
  text:
    description: "Human-readable text output"
    features:
      - "Colored output with severity indicators"
      - "Summary statistics"
      - "Recommendations formatted as bullets"
      - "Progress indicators during analysis"
  
  json:
    description: "Machine-readable JSON output"
    schema:
      type: "object"
      properties:
        summary:
          type: "object"
          properties:
            totalPackages: { type: "number" }
            securityIssues: { type: "number" }
            overallRisk: { type: "string", enum: ["LOW", "MEDIUM", "HIGH", "CRITICAL"] }
            analysisTime: { type: "number" }
        packages:
          type: "array"
          items:
            $ref: "#/components/schemas/AnalysisReport"
  
  html:
    description: "Detailed HTML report"
    features:
      - "Executive summary section"
      - "Detailed findings with links"
      - "Interactive dependency tree visualization"
      - "Exportable and shareable format"